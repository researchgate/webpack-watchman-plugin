language: node_js
sudo: true
node_js:
  - "8"
  - "7"
  - "6"
  - "4"

env:
  - JOB=test

matrix:
  include:
    - node_js: "lts/*"
      env: JOB=lint

before_install:
  - yarn global add greenkeeper-lockfile@1
  - git clone --depth=1 --branch=v4.7.0 https://github.com/facebook/watchman.git
  - pushd watchman && ./autogen.sh && ./configure --without-python && make && sudo make install && popd

before_script: greenkeeper-lockfile-update

script:
  - 'if [ "$JOB" = "test" ]; then yarn test; fi'
  - 'if [ "$JOB" = "lint" ]; then yarn run lint && yarn run flow; fi'

after_script: greenkeeper-lockfile-upload

after_success:
  - 'if [ "$JOB" = "test" ]; then bash <(curl -s https://codecov.io/bash) -f coverage/coverage-final.json ; fi'
